<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Welcome to Shaun's rabbit hole. This site serves as a personal knowledge base for me to record my thoughts and ideas. It is also a place for me to share my knowledge and experience with the world. I hope you find something useful here."><meta name=author content=Eamon><link href=https://bodani.github.io/docs/postgres/maintenance/partition/ rel=canonical><link href=../../install/pgstattuple/ rel=prev><link href=../../tools/monitor/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.3"><title>分区表 - TeaLabs</title><link rel=stylesheet href=../../../assets/stylesheets/main.50c56a3b.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><link rel=stylesheet href=../../../custom-style/custom-styles.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=TeaLabs class="md-header__button md-logo" aria-label=TeaLabs data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TeaLabs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 分区表 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=green data-md-color-accent=deep_orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../mysql/ class=md-tabs__link> MYSQL </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> PostgreSQL </a> </li> <li class=md-tabs__item> <a href=../../../middleware/ class=md-tabs__link> 中间件 </a> </li> <li class=md-tabs__item> <a href=../../../kubernetes/sts_update/ class=md-tabs__link> 容器 </a> </li> <li class=md-tabs__item> <a href=../../../linux/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../thinking_in_db_fd/ class=md-tabs__link> 数据库思考 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=TeaLabs class="md-nav__button md-logo" aria-label=TeaLabs data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> TeaLabs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../../mysql/ class="md-nav__link "> <span class=md-ellipsis> MYSQL </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> MYSQL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mysql/install/ class=md-nav__link> <span class=md-ellipsis> 安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../mysql/config/ class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../mysql/PrivilegeManagement/ class=md-nav__link> <span class=md-ellipsis> 权限管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../mysql/users/ class=md-nav__link> <span class=md-ellipsis> 用户管理 </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_6> <div class="md-nav__link md-nav__container"> <a href=../../../mysql/replication/ class="md-nav__link "> <span class=md-ellipsis> 主从复制 </span> </a> <label class="md-nav__link " for=__nav_1_6 id=__nav_1_6_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_1_6> <span class="md-nav__icon md-icon"></span> 主从复制 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mysql/replication/replication/ class=md-nav__link> <span class=md-ellipsis> 异步复制 </span> </a> </li> <li class=md-nav__item> <a href=../../../mysql/replication/semisync/ class=md-nav__link> <span class=md-ellipsis> 半同步复制 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_7> <label class=md-nav__link for=__nav_1_7 id=__nav_1_7_label tabindex> <span class=md-ellipsis> 高可用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_7_label aria-expanded=false> <label class=md-nav__title for=__nav_1_7> <span class="md-nav__icon md-icon"></span> 高可用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mysql/MGR/ class=md-nav__link> <span class=md-ellipsis> 组复制 </span> </a> </li> <li class=md-nav__item> <a href=../../../mysql/myshellMGR/ class=md-nav__link> <span class=md-ellipsis> mysqlsh </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_8> <label class=md-nav__link for=__nav_1_8 id=__nav_1_8_label tabindex> <span class=md-ellipsis> 监控 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_8_label aria-expanded=false> <label class=md-nav__title for=__nav_1_8> <span class="md-nav__icon md-icon"></span> 监控 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mysql/exporter/ class=md-nav__link> <span class=md-ellipsis> exporter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_9> <label class=md-nav__link for=__nav_1_9 id=__nav_1_9_label tabindex> <span class=md-ellipsis> 压测 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_9_label aria-expanded=false> <label class=md-nav__title for=__nav_1_9> <span class="md-nav__icon md-icon"></span> 压测 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mysql/mysqlslap/ class=md-nav__link> <span class=md-ellipsis> mysqlslap </span> </a> </li> <li class=md-nav__item> <a href=https://bodani.github.io/mysql45 class=md-nav__link> <span class=md-ellipsis> mysql45 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> PostgreSQL </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> PostgreSQL </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> 安装与配置 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 安装与配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../install/install01/ class=md-nav__link> <span class=md-ellipsis> 安装 </span> </a> </li> <li class=md-nav__item> <a href=../../install/install02/ class=md-nav__link> <span class=md-ellipsis> 安装详解 </span> </a> </li> <li class=md-nav__item> <a href=../../install/install/ class=md-nav__link> <span class=md-ellipsis> 安装进阶 </span> </a> </li> <li class=md-nav__item> <a href=../../install/config/ class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex> <span class=md-ellipsis> 高可用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 高可用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ha/ha_fd/ class=md-nav__link> <span class=md-ellipsis> 设计分析 </span> </a> </li> <li class=md-nav__item> <a href=../../ha/patroni/ class=md-nav__link> <span class=md-ellipsis> Patroni集群 </span> </a> </li> <li class=md-nav__item> <a href=../../ha/patroni02/ class=md-nav__link> <span class=md-ellipsis> Patroni高级 </span> </a> </li> <li class=md-nav__item> <a href=../../ha/pgautofailover/ class=md-nav__link> <span class=md-ellipsis> PGAutofailover </span> </a> </li> <li class=md-nav__item> <a href=../../ha/repmgr/ class=md-nav__link> <span class=md-ellipsis> Repmgr </span> </a> </li> <li class=md-nav__item> <a href=../../ha/repmgrd/ class=md-nav__link> <span class=md-ellipsis> RepmgrD </span> </a> </li> <li class=md-nav__item> <a href=../../ha/adlock/ class=md-nav__link> <span class=md-ellipsis> 一致性 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <div class="md-nav__link md-nav__container"> <a href=../../index/ class="md-nav__link "> <span class=md-ellipsis> 索引与查询优化 </span> </a> <label class="md-nav__link " for=__nav_2_4 id=__nav_2_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 索引与查询优化 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../index/index01/ class=md-nav__link> <span class=md-ellipsis> 索引类型及使用场景 </span> </a> </li> <li class=md-nav__item> <a href=../../index/index-invalid/ class=md-nav__link> <span class=md-ellipsis> 索引失效 </span> </a> </li> <li class=md-nav__item> <a href=../../index/index-bloom/ class=md-nav__link> <span class=md-ellipsis> Bloom索引 </span> </a> </li> <li class=md-nav__item> <a href=../../index/hypopg-index/ class=md-nav__link> <span class=md-ellipsis> 假设索引 </span> </a> </li> <li class=md-nav__item> <a href=../../index/partman.md class=md-nav__link> <span class=md-ellipsis> Partman插件 </span> </a> </li> <li class=md-nav__item> <a href=../../index/template/ class=md-nav__link> <span class=md-ellipsis> 模板表 </span> </a> </li> <li class=md-nav__item> <a href=../../index/unlogged_table/ class=md-nav__link> <span class=md-ellipsis> 未记录表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex> <span class=md-ellipsis> 性能优化 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 性能优化 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../performance/fillfactor/ class=md-nav__link> <span class=md-ellipsis> 填充因子 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/stat/ class=md-nav__link> <span class=md-ellipsis> 统计信息 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/params/ class=md-nav__link> <span class=md-ellipsis> 参数优化 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/high_level_sql/ class=md-nav__link> <span class=md-ellipsis> 高级SQL </span> </a> </li> <li class=md-nav__item> <a href=../../performance/FunctionsandOperators/ class=md-nav__link> <span class=md-ellipsis> 连接函数 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/vacuum/ class=md-nav__link> <span class=md-ellipsis> VACUUM操作 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/vacuum_limit/ class=md-nav__link> <span class=md-ellipsis> VACUUM限制 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/hotupdate/ class=md-nav__link> <span class=md-ellipsis> 冻结机制 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/thinking_in_db_performance/ class=md-nav__link> <span class=md-ellipsis> 性能优化思考 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/thinking_in_db_tune/ class=md-nav__link> <span class=md-ellipsis> 系统调优 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6 checked> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex> <span class=md-ellipsis> 数据维护 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=true> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 数据维护 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../install/toast/ class=md-nav__link> <span class=md-ellipsis> 事务管理 </span> </a> </li> <li class=md-nav__item> <a href=../../install/delete/ class=md-nav__link> <span class=md-ellipsis> 数据删除 </span> </a> </li> <li class=md-nav__item> <a href=../../install/checkpoint/ class=md-nav__link> <span class=md-ellipsis> 检查点 </span> </a> </li> <li class=md-nav__item> <a href=../../install/daily_management/ class=md-nav__link> <span class=md-ellipsis> 日常管理 </span> </a> </li> <li class=md-nav__item> <a href=../../install/bgwriter/ class=md-nav__link> <span class=md-ellipsis> BGWriter </span> </a> </li> <li class=md-nav__item> <a href=../../install/tablespace/ class=md-nav__link> <span class=md-ellipsis> 表空间 </span> </a> </li> <li class=md-nav__item> <a href=../../install/pgstattuple/ class=md-nav__link> <span class=md-ellipsis> 空间工具 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_rewrite.md class=md-nav__link> <span class=md-ellipsis> 表迁移 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_pathman.md class=md-nav__link> <span class=md-ellipsis> pg_pathman </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 分区表 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 分区表 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 表分区的意义 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 分区表设计 </span> </a> <nav class=md-nav aria-label=分区表设计> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 主键与分区键的关系 </span> </a> <nav class=md-nav aria-label=主键与分区键的关系> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 为什么要将分区键纳入主键？ </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 联合主键最佳实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 分区表使用 </span> </a> <nav class=md-nav aria-label=分区表使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 范围分区 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 列表分区 </span> </a> </li> <li class=md-nav__item> <a href=#hash class=md-nav__link> <span class=md-ellipsis> Hash 分区 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 各种分区方法的比较和选择 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 其他重要注意事项 </span> </a> <nav class=md-nav aria-label=其他重要注意事项> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 分区键选取 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 分区大小考虑 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 分区数量管理 </span> </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 默认分区 </span> </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> <span class=md-ellipsis> 表结构变更的影响 </span> </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> <span class=md-ellipsis> 索引操作 </span> </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> <span class=md-ellipsis> 分区键更新 </span> </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> <span class=md-ellipsis> 主键和唯一约束注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> <span class=md-ellipsis> 分区创建管理 </span> </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> <span class=md-ellipsis> 分区裁剪参数优化 </span> </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> <span class=md-ellipsis> 事务与锁定注意事项 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> <span class=md-ellipsis> 唯一约束与索引在分区表中的行为 </span> </a> <nav class=md-nav aria-label=唯一约束与索引在分区表中的行为> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_24 class=md-nav__link> <span class=md-ellipsis> 跨分区唯一约束 </span> </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> <span class=md-ellipsis> 索引策略 </span> </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> <span class=md-ellipsis> 大数据量性能对比测试 </span> </a> <nav class=md-nav aria-label=大数据量性能对比测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_27 class=md-nav__link> <span class=md-ellipsis> 数据分布 </span> </a> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> <span class=md-ellipsis> 统计信息收集 </span> </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> <span class=md-ellipsis> 重要的实现细节和注意事项 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> <span class=md-ellipsis> 关于表转换的澄清 </span> </a> <nav class=md-nav aria-label=关于表转换的澄清> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_31 class=md-nav__link> <span class=md-ellipsis> 传统迁移方式 </span> </a> </li> <li class=md-nav__item> <a href=#_32 class=md-nav__link> <span class=md-ellipsis> 现代迁移方式（通过将常规表作为分区） </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_33 class=md-nav__link> <span class=md-ellipsis> 将现有常规表作为分区表的分区 </span> </a> <nav class=md-nav aria-label=将现有常规表作为分区表的分区> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_34 class=md-nav__link> <span class=md-ellipsis> 停机迁移 </span> </a> <nav class=md-nav aria-label=停机迁移> <ul class=md-nav__list> <li class=md-nav__item> <a href=#select-into class=md-nav__link> <span class=md-ellipsis> SELECT INTO 方式 </span> </a> </li> <li class=md-nav__item> <a href=#copy class=md-nav__link> <span class=md-ellipsis> COPY 方式 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_35 class=md-nav__link> <span class=md-ellipsis> 不停机迁移 </span> </a> <nav class=md-nav aria-label=不停机迁移> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_36 class=md-nav__link> <span class=md-ellipsis> 逻辑复制 </span> </a> </li> <li class=md-nav__item> <a href=#pg_partman-pg_write class=md-nav__link> <span class=md-ellipsis> pg_partman + pg_write </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_37 class=md-nav__link> <span class=md-ellipsis> 表分区管理 </span> </a> <nav class=md-nav aria-label=表分区管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pg_pathman class=md-nav__link> <span class=md-ellipsis> pg_pathman </span> </a> </li> <li class=md-nav__item> <a href=#pg_partman class=md-nav__link> <span class=md-ellipsis> pg_partman </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex> <span class=md-ellipsis> 监控分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 监控分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/monitor/ class=md-nav__link> <span class=md-ellipsis> 监控基础 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/monitor-sql/ class=md-nav__link> <span class=md-ellipsis> SQL监控 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/view_pg_stat_activity/ class=md-nav__link> <span class=md-ellipsis> STAT视图 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/view_pg_stat_bgwriter/ class=md-nav__link> <span class=md-ellipsis> 统计BGWriter </span> </a> </li> <li class=md-nav__item> <a href=../../tools/monitor_explain/ class=md-nav__link> <span class=md-ellipsis> Explain分析 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_activity/ class=md-nav__link> <span class=md-ellipsis> 活动视图 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/dba/ class=md-nav__link> <span class=md-ellipsis> 数据库监控 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex> <span class=md-ellipsis> 扩展模块 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> 扩展模块 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../extentions/citus01/ class=md-nav__link> <span class=md-ellipsis> Citus分布式 </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/citus11/ class=md-nav__link> <span class=md-ellipsis> Citus高级 </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/timescaledb/ class=md-nav__link> <span class=md-ellipsis> TimescaleDB </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/pipelinedb01/ class=md-nav__link> <span class=md-ellipsis> PipelineDB </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/pipelinedb02/ class=md-nav__link> <span class=md-ellipsis> PipelineDB实战 </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/pgpool2/ class=md-nav__link> <span class=md-ellipsis> PGPool-II </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/pgbouncer/ class=md-nav__link> <span class=md-ellipsis> PGBouncer </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/pg_rman/ class=md-nav__link> <span class=md-ellipsis> PGBackRMAN </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/pg_fdw/ class=md-nav__link> <span class=md-ellipsis> FDW外部表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex> <span class=md-ellipsis> 数据同步 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> 数据同步 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../replication/replication01/ class=md-nav__link> <span class=md-ellipsis> 流复制 </span> </a> </li> <li class=md-nav__item> <a href=../../replication/replication02/ class=md-nav__link> <span class=md-ellipsis> 复制原理 </span> </a> </li> <li class=md-nav__item> <a href=../../replication/logical-replication/ class=md-nav__link> <span class=md-ellipsis> 逻辑复制 </span> </a> </li> <li class=md-nav__item> <a href=../../replication/logical-replication_failover/ class=md-nav__link> <span class=md-ellipsis> 逻辑复制故障切换 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_rewind/ class=md-nav__link> <span class=md-ellipsis> pg_rewind </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_10> <div class="md-nav__link md-nav__container"> <a href=../../backup/ class="md-nav__link "> <span class=md-ellipsis> 备份与恢复 </span> </a> <label class="md-nav__link " for=__nav_2_10 id=__nav_2_10_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_10_label aria-expanded=false> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> 备份与恢复 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../backup/logical-backup/ class=md-nav__link> <span class=md-ellipsis> 逻辑备份 </span> </a> </li> <li class=md-nav__item> <a href=../../backup/physical-backup/ class=md-nav__link> <span class=md-ellipsis> 物理备份 </span> </a> </li> <li class=md-nav__item> <a href=../../backup/pgbackrest/ class=md-nav__link> <span class=md-ellipsis> pgBackRest </span> </a> </li> <li class=md-nav__item> <a href=../../backup/wal-g/ class=md-nav__link> <span class=md-ellipsis> WAL-G备份 </span> </a> </li> <li class=md-nav__item> <a href=../../backup/pgcopydb/ class=md-nav__link> <span class=md-ellipsis> pgcopydb迁移 </span> </a> </li> <li class=md-nav__item> <a href=../../backup/reback/ class=md-nav__link> <span class=md-ellipsis> 数据恢复基础 </span> </a> </li> <li class=md-nav__item> <a href=../../backup/reback_supper_user/ class=md-nav__link> <span class=md-ellipsis> 超级用户恢复 </span> </a> </li> <li class=md-nav__item> <a href=../../backup/pitr/ class=md-nav__link> <span class=md-ellipsis> PITR备份恢复 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_11> <label class=md-nav__link for=__nav_2_11 id=__nav_2_11_label tabindex> <span class=md-ellipsis> 安全管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_11_label aria-expanded=false> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> 安全管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../security/role-manager/ class=md-nav__link> <span class=md-ellipsis> 角色管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../mysql/PrivilegeManagement/ class=md-nav__link> <span class=md-ellipsis> 权限管理 </span> </a> </li> <li class=md-nav__item> <a href=../../security/login_nopasswd/ class=md-nav__link> <span class=md-ellipsis> 连接认证 </span> </a> </li> <li class=md-nav__item> <a href=../../security/ssl/ class=md-nav__link> <span class=md-ellipsis> SSL安全 </span> </a> </li> <li class=md-nav__item> <a href=../../security/prepare/ class=md-nav__link> <span class=md-ellipsis> 备用服务 </span> </a> </li> <li class=md-nav__item> <a href=../../security/readonly/ class=md-nav__link> <span class=md-ellipsis> 只读 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_12> <label class=md-nav__link for=__nav_2_12 id=__nav_2_12_label tabindex> <span class=md-ellipsis> 高级特性 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_12_label aria-expanded=false> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> 高级特性 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../design/wal_lsn/ class=md-nav__link> <span class=md-ellipsis> WAL操作详解 </span> </a> </li> <li class=md-nav__item> <a href=../../design/wal_size/ class=md-nav__link> <span class=md-ellipsis> WAL配置大小 </span> </a> </li> <li class=md-nav__item> <a href=../../design/insert01/ class=md-nav__link> <span class=md-ellipsis> 高级插入技巧 </span> </a> </li> <li class=md-nav__item> <a href=../../design/upset/ class=md-nav__link> <span class=md-ellipsis> UPSERT </span> </a> </li> <li class=md-nav__item> <a href=../../design/hll/ class=md-nav__link> <span class=md-ellipsis> HLL统计 </span> </a> </li> <li class=md-nav__item> <a href=../../design/pg_json/ class=md-nav__link> <span class=md-ellipsis> JSON处理 </span> </a> </li> <li class=md-nav__item> <a href=../../design/pg_trgm/ class=md-nav__link> <span class=md-ellipsis> TRGM相似搜索 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_13> <label class=md-nav__link for=__nav_2_13 id=__nav_2_13_label tabindex> <span class=md-ellipsis> 数据库设计 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_13_label aria-expanded=false> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> 数据库设计 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../design/normal-form/ class=md-nav__link> <span class=md-ellipsis> 范式理论 </span> </a> </li> <li class=md-nav__item> <a href=../../design/materialized/ class=md-nav__link> <span class=md-ellipsis> 物化视图 </span> </a> </li> <li class=md-nav__item> <a href=../../design/extention/ class=md-nav__link> <span class=md-ellipsis> 扩展功能 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_14> <label class=md-nav__link for=__nav_2_14 id=__nav_2_14_label tabindex> <span class=md-ellipsis> 工具集 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_14_label aria-expanded=false> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> 工具集 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/pgbench/ class=md-nav__link> <span class=md-ellipsis> pgbench压测 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_elk/ class=md-nav__link> <span class=md-ellipsis> 集群扩展 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_prewarm/ class=md-nav__link> <span class=md-ellipsis> 预加载缓存 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_buffercache/ class=md-nav__link> <span class=md-ellipsis> 统计预缓存 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pgfincore/ class=md-nav__link> <span class=md-ellipsis> 模糊查询 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/lock_wait/ class=md-nav__link> <span class=md-ellipsis> 锁等待分析 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pgage/ class=md-nav__link> <span class=md-ellipsis> 行数统计 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pgwatch2/ class=md-nav__link> <span class=md-ellipsis> 监控系统 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_prewarm/ class=md-nav__link> <span class=md-ellipsis> 数据预热 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_lock/ class=md-nav__link> <span class=md-ellipsis> 读写分析 </span> </a> </li> <li class=md-nav__item> <a href=../../install/pgstattuple/ class=md-nav__link> <span class=md-ellipsis> 表分析 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_citus/ class=md-nav__link> <span class=md-ellipsis> CITUS扩展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_15> <label class=md-nav__link for=__nav_2_15 id=__nav_2_15_label tabindex> <span class=md-ellipsis> 版本与历史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_15_label aria-expanded=false> <label class=md-nav__title for=__nav_2_15> <span class="md-nav__icon md-icon"></span> 版本与历史 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../install/postgres12/ class=md-nav__link> <span class=md-ellipsis> 12版特性 </span> </a> </li> <li class=md-nav__item> <a href=../../install/postgresql-howto/ class=md-nav__link> <span class=md-ellipsis> 使用指南 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/tpch/ class=md-nav__link> <span class=md-ellipsis> TPC-H基准 </span> </a> </li> <li class=md-nav__item> <a href=../archive/ class=md-nav__link> <span class=md-ellipsis> 备份归档 </span> </a> </li> <li class=md-nav__item> <a href=../../extentions/citus01/ class=md-nav__link> <span class=md-ellipsis> 扩展目录 </span> </a> </li> <li class=md-nav__item> <a href=../../install/config/ class=md-nav__link> <span class=md-ellipsis> 配置文件目录 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/monitor/ class=md-nav__link> <span class=md-ellipsis> 监控目录 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_16> <label class=md-nav__link for=__nav_2_16 id=__nav_2_16_label tabindex> <span class=md-ellipsis> 架构与原理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_16_label aria-expanded=false> <label class=md-nav__title for=__nav_2_16> <span class="md-nav__icon md-icon"></span> 架构与原理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../install/cluster/ class=md-nav__link> <span class=md-ellipsis> 数据库架构 </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/debezium/ class=md-nav__link> <span class=md-ellipsis> 系统分析 </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/dts/ class=md-nav__link> <span class=md-ellipsis> 迁移与DTS </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/explain/ class=md-nav__link> <span class=md-ellipsis> 系统锁定分析 </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/libpg/ class=md-nav__link> <span class=md-ellipsis> 登录处理流程 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_rewrite.md class=md-nav__link> <span class=md-ellipsis> 功能分析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_17> <label class=md-nav__link for=__nav_2_17 id=__nav_2_17_label tabindex> <span class=md-ellipsis> 故障排除与问题解决 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_17_label aria-expanded=false> <label class=md-nav__title for=__nav_2_17> <span class="md-nav__icon md-icon"></span> 故障排除与问题解决 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../troubleshooting/oom/ class=md-nav__link> <span class=md-ellipsis> OOM问题 </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/auto_vacuum_trigger/ class=md-nav__link> <span class=md-ellipsis> 空间自动清理 </span> </a> </li> <li class=md-nav__item> <a href=../../tools/pg_prewarm/ class=md-nav__link> <span class=md-ellipsis> 数据预加载 </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/awsome-postgres/ class=md-nav__link> <span class=md-ellipsis> 案例研究 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../../middleware/ class="md-nav__link "> <span class=md-ellipsis> 中间件 </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 中间件 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <div class="md-nav__link md-nav__container"> <a href=../../../clickhouse/install/ class="md-nav__link "> <span class=md-ellipsis> ClickHouse </span> </a> <label class="md-nav__link " for=__nav_3_2 id=__nav_3_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> ClickHouse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../clickhouse/install/install_single/ class=md-nav__link> <span class=md-ellipsis> 单机版 </span> </a> </li> <li class=md-nav__item> <a href=../../../clickhouse/install/install_cluster/ class=md-nav__link> <span class=md-ellipsis> 集群版 </span> </a> </li> <li class=md-nav__item> <a href=../../../clickhouse/ch-keeper/ class=md-nav__link> <span class=md-ellipsis> keeper </span> </a> </li> <li class=md-nav__item> <a href=../../../clickhouse/demo/ class=md-nav__link> <span class=md-ellipsis> 表引擎 </span> </a> </li> <li class=md-nav__item> <a href=../../../clickhouse/compresstion/ class=md-nav__link> <span class=md-ellipsis> 压缩 </span> </a> </li> <li class=md-nav__item> <a href=../../../clickhouse/restore/ class=md-nav__link> <span class=md-ellipsis> 恢复 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> MongoDB </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> MongoDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mongodb/install/ class=md-nav__link> <span class=md-ellipsis> 安装 </span> </a> </li> <li class=md-nav__item> <a href=../../../mongodb/config/ class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../mongodb/replication/ class=md-nav__link> <span class=md-ellipsis> 副本集 </span> </a> </li> <li class=md-nav__item> <a href=../../../mongodb/sharding/ class=md-nav__link> <span class=md-ellipsis> 分片集群 </span> </a> </li> <li class=md-nav__item> <a href=../../../mongodb/privilege/ class=md-nav__link> <span class=md-ellipsis> 权限管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../mongodb/backup_restore/ class=md-nav__link> <span class=md-ellipsis> 备份恢复 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> 监控系统 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 监控系统 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../monitor/prometheus/ class=md-nav__link> <span class=md-ellipsis> Prometheus </span> </a> </li> <li class=md-nav__item> <a href=../../../monitor/grafana/ class=md-nav__link> <span class=md-ellipsis> Grafana </span> </a> </li> <li class=md-nav__item> <a href=../../../monitor/exporter/ class=md-nav__link> <span class=md-ellipsis> exporter </span> </a> </li> <li class=md-nav__item> <a href=../../../monitor/metrics/ class=md-nav__link> <span class=md-ellipsis> 监控指标 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> fluentbit </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> fluentbit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../fluentbit/intro/ class=md-nav__link> <span class=md-ellipsis> 介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../fluentbit/problems/ class=md-nav__link> <span class=md-ellipsis> 问题排查 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> 容器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/sts_update/ class=md-nav__link> <span class=md-ellipsis> sts 滚动更新 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../../linux/ class="md-nav__link "> <span class=md-ellipsis> Linux </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex> <span class=md-ellipsis> 基础工具与系统管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 基础工具与系统管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/tools/ class=md-nav__link> <span class=md-ellipsis> 系统工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/process-comm/ class=md-nav__link> <span class=md-ellipsis> 进程管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/sysstat/ class=md-nav__link> <span class=md-ellipsis> 性能监控 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/meminfo/ class=md-nav__link> <span class=md-ellipsis> 内存管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/hard_store/ class=md-nav__link> <span class=md-ellipsis> 磁盘管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/findhidpid/ class=md-nav__link> <span class=md-ellipsis> 文件系统工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/time-cmd/ class=md-nav__link> <span class=md-ellipsis> 时间管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/mail/ class=md-nav__link> <span class=md-ellipsis> 邮件管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cpu_temp/ class=md-nav__link> <span class=md-ellipsis> 电源管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/syslog/ class=md-nav__link> <span class=md-ellipsis> 系统日志 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex> <span class=md-ellipsis> 命令详解与实用工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 命令详解与实用工具 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/cmd-awk/ class=md-nav__link> <span class=md-ellipsis> awk命令详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cmd-gpasswd/ class=md-nav__link> <span class=md-ellipsis> gpasswd命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cmd-sed/ class=md-nav__link> <span class=md-ellipsis> sed命令详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cmd-vim/ class=md-nav__link> <span class=md-ellipsis> vim命令使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cmd-xargs/ class=md-nav__link> <span class=md-ellipsis> xargs命令使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/fu-cmd/ class=md-nav__link> <span class=md-ellipsis> 其他常用命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/install-cmd/ class=md-nav__link> <span class=md-ellipsis> 系统安装相关命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cmd-pstack/ class=md-nav__link> <span class=md-ellipsis> 安装相关脚本工具 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex> <span class=md-ellipsis> 虚拟化与容器技术 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 虚拟化与容器技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/kvm01/ class=md-nav__link> <span class=md-ellipsis> KVM 虚拟化 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/kuberctl/ class=md-nav__link> <span class=md-ellipsis> K8s 管理工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/wind-run/ class=md-nav__link> <span class=md-ellipsis> 容器网络管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex> <span class=md-ellipsis> 硬件与驱动管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> 硬件与驱动管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/smartctl/ class=md-nav__link> <span class=md-ellipsis> 硬件监控 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/dmidecode/ class=md-nav__link> <span class=md-ellipsis> 硬件信息查询 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/mdadm/ class=md-nav__link> <span class=md-ellipsis> 磁盘阵列管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/hdparm/ class=md-nav__link> <span class=md-ellipsis> 硬盘性能检测 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/ipmitool/ class=md-nav__link> <span class=md-ellipsis> 远程硬件管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cpu_utilize/ class=md-nav__link> <span class=md-ellipsis> CPU温度与利用率 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex> <span class=md-ellipsis> 安全与权限管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> 安全与权限管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/webmanage/ class=md-nav__link> <span class=md-ellipsis> 系统安全管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/nice/ class=md-nav__link> <span class=md-ellipsis> 用户权限管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/wheel/ class=md-nav__link> <span class=md-ellipsis> 临时用户组 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/no-passwd/ class=md-nav__link> <span class=md-ellipsis> 免密登录配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/bmcpasswd/ class=md-nav__link> <span class=md-ellipsis> sudo配置与BMC </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/git-nopassword/ class=md-nav__link> <span class=md-ellipsis> Git免密配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/resetpasswd-centos7/ class=md-nav__link> <span class=md-ellipsis> 账户密码重置 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/at-crontab/ class=md-nav__link> <span class=md-ellipsis> 任务调度管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/terminal-reuse/ class=md-nav__link> <span class=md-ellipsis> 终端会话复用 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/ln-s/ class=md-nav__link> <span class=md-ellipsis> SSH免密与连接 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/openvpn/ class=md-nav__link> <span class=md-ellipsis> 安全VPN管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex> <span class=md-ellipsis> 系统配置与调优 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> 系统配置与调优 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/linux_tunning/ class=md-nav__link> <span class=md-ellipsis> 系统参数调整 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cpu-affinity/ class=md-nav__link> <span class=md-ellipsis> 进程优先级与CPU亲和性 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/kworker/ class=md-nav__link> <span class=md-ellipsis> 内核后台进程 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/qos/ class=md-nav__link> <span class=md-ellipsis> 网络QoS管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/init-centos/ class=md-nav__link> <span class=md-ellipsis> 系统启动优化 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/ubuntu2004-network/ class=md-nav__link> <span class=md-ellipsis> 网络配置Ubuntu </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/memtester/ class=md-nav__link> <span class=md-ellipsis> 系统内存大页 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/ssdiotimeout/ class=md-nav__link> <span class=md-ellipsis> I/O超时处理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/backlog-config/ class=md-nav__link> <span class=md-ellipsis> Backlog队列管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex> <span class=md-ellipsis> 存储与文件系统管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> 存储与文件系统管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/lvm/ class=md-nav__link> <span class=md-ellipsis> LVM存储管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/parted/ class=md-nav__link> <span class=md-ellipsis> 磁盘分区工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/fastdeletfiles/ class=md-nav__link> <span class=md-ellipsis> 系统空间清理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/nospace-device/ class=md-nav__link> <span class=md-ellipsis> 无空间设备处理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex> <span class=md-ellipsis> 网络与协议分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> 网络与协议分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/tcpdump/ class=md-nav__link> <span class=md-ellipsis> 网络抓包分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/iperf/ class=md-nav__link> <span class=md-ellipsis> 网络诊断工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/last/ class=md-nav__link> <span class=md-ellipsis> 网络状态监控 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/wget/ class=md-nav__link> <span class=md-ellipsis> 下载工具wget </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/stat/ class=md-nav__link> <span class=md-ellipsis> 系统资源统计 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex> <span class=md-ellipsis> 数据恢复与备份 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> 数据恢复与备份 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/ddrescue/ class=md-nav__link> <span class=md-ellipsis> 数据恢复ddrescue </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/fio/ class=md-nav__link> <span class=md-ellipsis> 磁盘性能测试fio </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/vm-config/ class=md-nav__link> <span class=md-ellipsis> VM性能配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/memtest/ class=md-nav__link> <span class=md-ellipsis> 内存测试 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/patch/ class=md-nav__link> <span class=md-ellipsis> 系统补丁管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex> <span class=md-ellipsis> 调试与性能分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> 调试与性能分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/perf/ class=md-nav__link> <span class=md-ellipsis> 性能分析工具perf </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/pmap/ class=md-nav__link> <span class=md-ellipsis> 内存映射分析pmap </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/pstack_strace/ class=md-nav__link> <span class=md-ellipsis> 进程调试 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/so/ class=md-nav__link> <span class=md-ellipsis> 符号表与共享库 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/cgroups/ class=md-nav__link> <span class=md-ellipsis> 硬件驱动分析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex> <span class=md-ellipsis> 安全增强工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> 安全增强工具 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/elfutil/ class=md-nav__link> <span class=md-ellipsis> ELF工具详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/pid_m/ class=md-nav__link> <span class=md-ellipsis> 调试堆栈分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/lang/ class=md-nav__link> <span class=md-ellipsis> 软件包语言配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_13> <label class=md-nav__link for=__nav_5_13 id=__nav_5_13_label tabindex> <span class=md-ellipsis> 系统维护与问题解决 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_13_label aria-expanded=false> <label class=md-nav__title for=__nav_5_13> <span class="md-nav__icon md-icon"></span> 系统维护与问题解决 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/lightdm/ class=md-nav__link> <span class=md-ellipsis> 轻量桌面管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/4k-wa/ class=md-nav__link> <span class=md-ellipsis> 硬盘4K对齐 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/repo/ class=md-nav__link> <span class=md-ellipsis> 仓库远程配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/git-sparsecheckout/ class=md-nav__link> <span class=md-ellipsis> 版本控制优化 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/github-dns/ class=md-nav__link> <span class=md-ellipsis> DNS优化配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/ubuntu2004-qa/ class=md-nav__link> <span class=md-ellipsis> Ubuntu2004常见问题 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/git-objects-clean/ class=md-nav__link> <span class=md-ellipsis> Git对象清理 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/xz/ class=md-nav__link> <span class=md-ellipsis> 归档压缩 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/frp/ class=md-nav__link> <span class=md-ellipsis> 便捷连接工具 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> 数据库思考 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 数据库思考 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../thinking_in_db_fd/ class=md-nav__link> <span class=md-ellipsis> 结构设计 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/thinking_in_db_performance/ class=md-nav__link> <span class=md-ellipsis> 性能优化 </span> </a> </li> <li class=md-nav__item> <a href=../../performance/thinking_in_db_tune/ class=md-nav__link> <span class=md-ellipsis> 模块调优 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 表分区的意义 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 分区表设计 </span> </a> <nav class=md-nav aria-label=分区表设计> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 主键与分区键的关系 </span> </a> <nav class=md-nav aria-label=主键与分区键的关系> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 为什么要将分区键纳入主键？ </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 联合主键最佳实践 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 分区表使用 </span> </a> <nav class=md-nav aria-label=分区表使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 范围分区 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 列表分区 </span> </a> </li> <li class=md-nav__item> <a href=#hash class=md-nav__link> <span class=md-ellipsis> Hash 分区 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 各种分区方法的比较和选择 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 其他重要注意事项 </span> </a> <nav class=md-nav aria-label=其他重要注意事项> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 分区键选取 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 分区大小考虑 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 分区数量管理 </span> </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 默认分区 </span> </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> <span class=md-ellipsis> 表结构变更的影响 </span> </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> <span class=md-ellipsis> 索引操作 </span> </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> <span class=md-ellipsis> 分区键更新 </span> </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> <span class=md-ellipsis> 主键和唯一约束注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> <span class=md-ellipsis> 分区创建管理 </span> </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> <span class=md-ellipsis> 分区裁剪参数优化 </span> </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> <span class=md-ellipsis> 事务与锁定注意事项 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> <span class=md-ellipsis> 唯一约束与索引在分区表中的行为 </span> </a> <nav class=md-nav aria-label=唯一约束与索引在分区表中的行为> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_24 class=md-nav__link> <span class=md-ellipsis> 跨分区唯一约束 </span> </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> <span class=md-ellipsis> 索引策略 </span> </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> <span class=md-ellipsis> 大数据量性能对比测试 </span> </a> <nav class=md-nav aria-label=大数据量性能对比测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_27 class=md-nav__link> <span class=md-ellipsis> 数据分布 </span> </a> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> <span class=md-ellipsis> 统计信息收集 </span> </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> <span class=md-ellipsis> 重要的实现细节和注意事项 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> <span class=md-ellipsis> 关于表转换的澄清 </span> </a> <nav class=md-nav aria-label=关于表转换的澄清> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_31 class=md-nav__link> <span class=md-ellipsis> 传统迁移方式 </span> </a> </li> <li class=md-nav__item> <a href=#_32 class=md-nav__link> <span class=md-ellipsis> 现代迁移方式（通过将常规表作为分区） </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_33 class=md-nav__link> <span class=md-ellipsis> 将现有常规表作为分区表的分区 </span> </a> <nav class=md-nav aria-label=将现有常规表作为分区表的分区> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_34 class=md-nav__link> <span class=md-ellipsis> 停机迁移 </span> </a> <nav class=md-nav aria-label=停机迁移> <ul class=md-nav__list> <li class=md-nav__item> <a href=#select-into class=md-nav__link> <span class=md-ellipsis> SELECT INTO 方式 </span> </a> </li> <li class=md-nav__item> <a href=#copy class=md-nav__link> <span class=md-ellipsis> COPY 方式 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_35 class=md-nav__link> <span class=md-ellipsis> 不停机迁移 </span> </a> <nav class=md-nav aria-label=不停机迁移> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_36 class=md-nav__link> <span class=md-ellipsis> 逻辑复制 </span> </a> </li> <li class=md-nav__item> <a href=#pg_partman-pg_write class=md-nav__link> <span class=md-ellipsis> pg_partman + pg_write </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_37 class=md-nav__link> <span class=md-ellipsis> 表分区管理 </span> </a> <nav class=md-nav aria-label=表分区管理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pg_pathman class=md-nav__link> <span class=md-ellipsis> pg_pathman </span> </a> </li> <li class=md-nav__item> <a href=#pg_partman class=md-nav__link> <span class=md-ellipsis> pg_partman </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>分区表</h1> <p>在现代数据库管理中，数据量不断增长导致单表性能下降成为常见的问题。PostgreSQL 的表分区功能可以帮助将大表拆分成更小的、更易管理的部分，从而提高性能并简化数据管理。</p> <h2 id=_2>表分区的意义</h2> <p>表分区是指将一个大表的数据按照一定的规则分布在多个物理子表中，但在逻辑上仍然被视为一个表。这种方式带来诸多益处：</p> <ul> <li><strong>性能优化</strong>：减少扫描的数据量，提升查询速度</li> <li><strong>管理简便</strong>：易于管理和维护数据生命周期</li> <li><strong>数据局部性</strong>：减少锁竞争</li> <li><strong>索引局部性</strong>：较小的索引可提升索引命中率</li> <li><strong>批量删除高效</strong>：可以直接删除整个分区来清除数据</li> <li><strong>并发提升</strong>：不同分区的访问可并行进行</li> </ul> <p>PostgreSQL 自 10 版本开始提供原生的分区支持，之后的版本也持续对其功能和性能进行改进，目前已成为处理大规模数据的理想手段。</p> <h2 id=_3>分区表设计</h2> <p>在设计分区表时，正确处理主键、唯一约束和索引是确保数据完整性和查询性能的重要环节。</p> <h3 id=_4>主键与分区键的关系</h3> <p>在 PostgreSQL 分区表中，主键和唯一约束有特殊的要求：它们必须包含分区键。</p> <h4 id=_5>为什么要将分区键纳入主键？</h4> <p>这是因为在 PostgreSQL 中，唯一约束（包括主键）只能在同一分区内部强制执行。如果主键或唯一约束不含分区键，那么就无法保证跨分区的唯一性。</p> <pre><code class=language-sql>-- 错误示例：在分区键 logdate 之外单独使用非分区字段作为主键会失败
CREATE TABLE measurement_bad (
    city_id         int not null,
    logdate         date not null,
    peaktemp        int,
    unitsales       int,
    PRIMARY KEY (city_id)  -- 这将失败，因为分区键 logdate 不在主键中
) PARTITION BY RANGE (logdate);
错误:  unique constraint on partitioned table must include all partitioning columns
-- 正确示例：主键或唯一约束必须包含分区键
CREATE TABLE measurement_good (
    city_id         int not null,
    logdate         date not null,
    peaktemp        int,
    unitsales       int,
    PRIMARY KEY (logdate, city_id)  -- 分区键 logdate 包含在主键中
) PARTITION BY RANGE (logdate);
</code></pre> <h4 id=_6>联合主键最佳实践</h4> <p>通常的做法是将分区键作为主键的一部分：</p> <pre><code class=language-sql>-- 示例：将日期和城市ID共同作为复合主键
CREATE TABLE measurement (
    city_id         int not null,
    logdate         date not null,
    peaktemp        int,
    unitsales       int,
    PRIMARY KEY (logdate, city_id)
) PARTITION BY RANGE (logdate);

-- 创建分区
CREATE TABLE measurement_y2024m01 PARTITION OF measurement
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');

CREATE TABLE measurement_y2024m02 PARTITION OF measurement
    FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');

-- 这样确保了主键的全局唯一性
INSERT INTO measurement VALUES (1, '2024-01-15', 45, 100);  -- OK
INSERT INTO measurement VALUES (1, '2024-01-15', 40, 120);  -- 将违反唯一性约束，被拒绝

-- 大数据量插入演示，以便展示分区表性能优势
INSERT INTO measurement SELECT
    floor(random()*1000)::int,
    '2024-01-01'::date + (random() * 30)::int,
    floor(random()*100)::int,
    floor(random()*1000)::int
FROM generate_series(1, 500000);  -- 插入50万条记录
</code></pre> <h2 id=_7>分区表使用</h2> <p>PostgreSQL 提供了多种表分区的方式以适应不同的应用场景。</p> <h3 id=_8>范围分区</h3> <p>范围分区基于某个列的值区间进行划分，适用于按日期、数值范围等维度分区的场景。</p> <pre><code class=language-sql>-- 范围分区，包含适当的主键设计
CREATE TABLE measurement (
    city_id         int not null,
    logdate         date not null,
    peaktemp        int,
    unitsales       int,
    PRIMARY KEY (logdate, city_id)  -- 主键包含分区键 logdate
) PARTITION BY RANGE (logdate);

-- 创建具体分区
CREATE TABLE measurement_y2024m01 PARTITION OF measurement
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');

CREATE TABLE measurement_y2024m02 PARTITION OF measurement
    FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');

CREATE TABLE measurement_y2024m03 PARTITION OF measurement
    FOR VALUES FROM ('2024-03-01') TO ('2024-04-01');

-- 插入数据
INSERT INTO measurement VALUES (1, '2024-01-15', 45, 100);
INSERT INTO measurement VALUES (2, '2024-02-15', 50, 120);

-- 查看分区
SELECT tableoid::regclass, * FROM measurement WHERE city_id = 1;
</code></pre> <p>还可以通过指定更多分区键创建更复杂的多维范围分区:</p> <pre><code class=language-sql>-- 多列范围分区
CREATE TABLE quarterly_report (
    id              bigserial,
    department      text,
    quarter_date    date,
    amount          decimal(10, 2),
    PRIMARY KEY (department, quarter_date, id)  -- 分区键包含在主键中
) PARTITION BY RANGE (department, quarter_date);

CREATE TABLE report_dep_a_q1 PARTITION OF quarterly_report
    FOR VALUES FROM ('A', '2024-01-01') TO ('A', '2024-04-01');

CREATE TABLE report_dep_b_q1 PARTITION OF quarterly_report
    FOR VALUES FROM ('B', '2024-01-01') TO ('B', '2024-04-01');
</code></pre> <h3 id=_9>列表分区</h3> <p>List 分区基于预定义的值列表进行分区，适用于按明确分类（如国家、状态代码等）对数据进行组织的场景。</p> <pre><code class=language-sql>-- List 分区，根据区域代码创建分区
CREATE TABLE regions_data (
    region_code char(2) NOT NULL,
    store_id    integer NOT NULL,
    sales       numeric,
    region_name varchar(50),
    PRIMARY KEY (region_code, store_id)
) PARTITION BY LIST (region_code);

-- 为不同的地区码创建分区
CREATE TABLE regions_us_west PARTITION OF regions_data
    FOR VALUES IN ('WA', 'OR', 'CA');

CREATE TABLE regions_us_east PARTITION OF regions_data
    FOR VALUES IN ('NY', 'PA', 'MD');

CREATE TABLE regions_us_south PARTITION OF regions_data
    FOR VALUES IN ('TX', 'FL', 'GA');

CREATE TABLE regions_us_central PARTITION OF regions_data
    FOR VALUES IN ('IL', 'MI', 'OH');

CREATE TABLE regions_international PARTITION OF regions_data
    FOR VALUES IN ('GB', 'FR', 'DE', 'JP', 'KR', 'SG');

-- 也可以用DEFAULT分区捕获未预定义的值
CREATE TABLE regions_default PARTITION OF regions_data DEFAULT;

-- 测试插入数据
INSERT INTO regions_data VALUES ('CA', 1, 10000, 'California');
INSERT INTO regions_data VALUES ('NY', 2, 12000, 'New York');
INSERT INTO regions_data VALUES ('DE', 3, 8000, 'Germany');
INSERT INTO regions_data VALUES ('CN', 4, 15000, 'China');  -- 会被放入default分区

-- 查看数据分布到哪些分区
SELECT tableoid::regclass, * FROM regions_data;
</code></pre> <p>使用 List 分区的优点:</p> <ul> <li>当需要按确切类别组织数据时特别有效</li> <li>适用于有限的、已知值集合的情况</li> <li>可以利用分区裁剪显著提高查询性能</li> </ul> <h3 id=hash>Hash 分区</h3> <p>Hash 分区通过对分区键应用哈希函数并将结果映射到指定分区的方式进行数据分配。这种类型适合数据需要随机分布到不同分区以均匀分摊工作负载的场景。</p> <pre><code class=language-sql>-- 在 Hash 分区中，同样要确保主键包含分区键
CREATE TABLE employees (
    id int not null,
    name text,
    email text,
    PRIMARY KEY (id, name)  -- id 是分区键，也需要包含在主键中
) PARTITION BY HASH (id);

-- 创建 4 个分区
CREATE TABLE emp_p0 PARTITION OF employees
    FOR VALUES WITH (MODULUS 4, REMAINDER 0);

CREATE TABLE emp_p1 PARTITION OF employees
    FOR VALUES WITH (MODULUS 4, REMAINDER 1);

CREATE TABLE emp_p2 PARTITION OF employees
    FOR VALUES WITH (MODULUS 4, REMAINDER 2);

CREATE TABLE emp_p3 PARTITION OF employees
    FOR VALUES WITH (MODULUS 4, REMAINDER 3);

-- 插入测试数据
INSERT INTO employees VALUES (1, 'Alice', 'alice@example.com');
INSERT INTO employees VALUES (2, 'Bob', 'bob@example.com');
INSERT INTO employees VALUES (3, 'Charlie', 'charlie@example.com');
</code></pre> <h3 id=_10>各种分区方法的比较和选择</h3> <table> <thead> <tr> <th>分区类型</th> <th>使用场景</th> <th>优点</th> <th>缺点</th> </tr> </thead> <tbody> <tr> <td>Range</td> <td>按时间或数值范围</td> <td>易理解，适合时间序列数据</td> <td>数据可能分布不均</td> </tr> <tr> <td>List</td> <td>按预定义列表值</td> <td>易于控制具体分区</td> <td>限制固定值集合</td> </tr> <tr> <td>Hash</td> <td>需要随机均匀分布</td> <td>均匀分布数据</td> <td>对查询优化有一定难度</td> </tr> </tbody> </table> <h2 id=_11>其他重要注意事项</h2> <h3 id=_12>分区键选取</h3> <p>应当基于表的常用查询模式选择合适的分区键，如表单的创建时间、区域编码等。分区键通常是WHERE条件中频繁使用的字段，例如日期字段或地域编码。</p> <h3 id=_13>分区大小考虑</h3> <p>一般认为一个分区表大小达到几GB到几十GB时才考虑使用分区。一个分区应该足够大以获得性能提升，但也不能过大以确保管理和维护的便利性。对于TB级的数据量，可以将每个月或每季度的数据放在一个分区中；对于较小的数据量（几百GB），则可能将每个季度或每年数据作为一个分区。</p> <h3 id=_14>分区数量管理</h3> <p>过多的分区可能会导致：</p> <ul> <li>过多的子表元数据，影响catalog扫描性能</li> <li>更多的后台进程和内存开销</li> <li>复杂的管理操作 通常建议控制分区数量，根据业务需要在颗粒度和管理复杂度间找到平衡点。</li> </ul> <h3 id=_15>默认分区</h3> <p>在使用 RANGE 或 LIST 分区时，可以创建一个默认分区来处理不在已定义分区范围内的数据：</p> <pre><code class=language-sql>CREATE TABLE measurement_default PARTITION OF measurement DEFAULT;
</code></pre> <p>这样当尝试插入不符合任何已定义分区条件的值时，不会报错，而是将数据存入默认分区。</p> <h3 id=_16>表结构变更的影响</h3> <p>更新父表结构会影响到已存在子表，但具体行为依赖于操作：</p> <ul> <li>增加列（WITH DEFAULT 或 NULL）会传递到所有子分区</li> <li>修改列数据类型可能会影响现有数据</li> <li>删除列也会影响子分区</li> <li>对现有子表结构的更改不会自动应用到新建分区</li> </ul> <h3 id=_17>索引操作</h3> <p>在父表上创建的索引对新增分区生效，但不会对已存在的分区生效。这意味着需要为所有现有分区单独创建相应的索引：</p> <ul> <li>使用 CONCURRENTLY 选项以避免锁定整个分区表</li> <li>通过 pg_partman 等工具可帮助批量处理</li> <li>考虑为高频查询字段在所有分区上都建立相应索引</li> </ul> <h3 id=_18>分区键更新</h3> <p>直接更新分区键字段会变成复杂的动作，实际上是删除旧记录并在新分区中创建新记录。在应用中应避免频繁修改分区键的值。</p> <h3 id=_19>主键和唯一约束注意事项</h3> <ul> <li>主键和唯一键必须包含分区键，否则无法保证跨分区的唯一性</li> <li>本地唯一索引（只应用于分区）在跨分区操作中不能提供整体唯一性</li> <li>为了在全局级别（跨越所有分区）实现主键或唯一性约束，必须包含分区键在内</li> </ul> <h3 id=_20>分区创建管理</h3> <ul> <li>手动管理方式适用于分区较少且规律固定的场景</li> <li>使用 pg_partman 等自动化工具可根据预定规则自动创建新分区</li> <li>对于动态范围（如按需创建新分区），需配合业务逻辑创建分区表</li> </ul> <h3 id=_21>分区裁剪参数优化</h3> <p>为了充分发挥分区表的性能优势，必须确保 enable_partition_pruning 参数被开启以激活分区裁剪功能。当 WHERE 子句包含分区键条件时，优化器会选择仅扫描相关的分区，大大提高了查询性能。</p> <ul> <li>检查当前设置：<code>SHOW enable_partition_pruning;</code></li> <li>启用参数：<code>SET enable_partition_pruning = on;</code> （会话级）</li> <li>永久设置需在 postgresql.conf 文件中修改</li> </ul> <p>另外，对于某些场景，也应确保：</p> <ul> <li>enable_bitmapscan = on</li> <li>enable_indexonlyscan = on</li> <li>对于复杂查询，确保约束排除功能有效（对于传统继承表，需要 enable_inheritance_optimization_parameters）</li> </ul> <h3 id=_22>事务与锁定注意事项</h3> <p>在大量插入或更新数据时需特别注意锁定行为：</p> <ul> <li>分区表的操作可能会在父表和涉及的分区上产生锁定</li> <li>对单个分区的操作只会影响特定分区的锁定</li> <li>批量操作前评估对整体系统的影响</li> </ul> <h2 id=_23>唯一约束与索引在分区表中的行为</h2> <h3 id=_24>跨分区唯一约束</h3> <p>由于唯一约束只能在同一分区内部验证，要实现真正的跨分区唯一性，分区键必须是唯一约束的一部分。</p> <pre><code class=language-sql>-- 错误：尝试在分区键外创建全局唯一约束不会成功
CREATE TABLE orders (
    order_id    int not null,
    order_date  date not null,
    customer_id int,
    PRIMARY KEY (order_date, order_id),
    UNIQUE (customer_id)  -- 这个约束只会在各自分区内部强制执行
) PARTITION BY RANGE (order_date);

-- 正确：若要实现 customer_id 全局唯一，需要将其与分区键一起构成唯一约束
CREATE TABLE orders_fixed (
    order_id    int not null,
    order_date  date not null,
    customer_id int,
    PRIMARY KEY (order_date, order_id),
    UNIQUE (customer_id, order_date)  -- 这确保了跨分区的唯一性
) PARTITION BY RANGE (order_date);

-- 或者创建单独的索引来实现特定查询需求
CREATE TABLE orders_indexed (
    order_id    int not null,
    order_date  date not null,
    customer_id int,
    PRIMARY KEY (order_date, order_id)
) PARTITION BY RANGE (order_date);

-- 可以为特定查询创建局部索引
-- 这个索引将在每个分区上分别创建
CREATE INDEX orders_customer_idx ON orders_indexed (customer_id);
</code></pre> <h3 id=_25>索引策略</h3> <p>在分区表中，创建索引需要特别注意：</p> <ol> <li>索引需要包含分区键以确保全局查询的有效性</li> <li>局部索引（每一分区一个）vs 全局索引（跨所有分区）的选择</li> <li>如何为频繁查询的字段创建合适索引</li> </ol> <pre><code class=language-sql>-- 在订单分区表中创建复合索引，包含分区键和查询字段
CREATE TABLE orders_composite (
    order_id     int not null,
    order_date   date not null,
    customer_id  int,
    product_id   int,
    quantity     int,
    PRIMARY KEY (order_date, order_id)
) PARTITION BY RANGE (order_date);

-- 创建包含分区键的复合索引，用于客户产品组合查询
CREATE INDEX orders_customer_product_idx ON orders_composite (customer_id, product_id, order_date);

-- 局部索引，在每一子分区上独立创建
CREATE INDEX orders_quantity_idx ON ONLY orders_composite (quantity);

-- 为新分区创建索引时，需要确保它们继承正确的索引结构
CREATE TABLE orders_2024 PARTITION OF orders_composite
    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

-- 对大数据量测试，我们可以使用以下示例
-- 创建一个更大的表用于演示分区性能
CREATE TABLE sales_data (
    sale_id         bigint generated always as identity,
    sale_date       date not null,
    product_id      int not null,
    customer_id     int not null,
    quantity_sold   int not null,
    sale_amount     numeric(10, 2) not null,
    region          varchar(50),
    PRIMARY KEY (sale_date, sale_id)  -- 确保分区键包含在主键中
) PARTITION BY RANGE (sale_date);

-- 创建多个月的分区
CREATE TABLE sales_jan2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
CREATE TABLE sales_feb2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');
CREATE TABLE sales_mar2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-03-01') TO ('2024-04-01');
CREATE TABLE sales_apr2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-04-01') TO ('2024-05-01');
CREATE TABLE sales_may2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-05-01') TO ('2024-06-01');
CREATE TABLE sales_jun2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-06-01') TO ('2024-07-01');
CREATE TABLE sales_jul2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-07-01') TO ('2024-08-01');
CREATE TABLE sales_aug2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-08-01') TO ('2024-09-01');
CREATE TABLE sales_sep2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-09-01') TO ('2024-10-01');
CREATE TABLE sales_oct2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-10-01') TO ('2024-11-01');
CREATE TABLE sales_nov2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-11-01') TO ('2024-12-01');
CREATE TABLE sales_dec2024 PARTITION OF sales_data
    FOR VALUES FROM ('2024-12-01') TO ('2025-01-01');

-- 生成模拟销售数据，用于展示大数据量下的性能差异
-- 这里将生成 300万 条记录用于演示
INSERT INTO sales_data (sale_date, product_id, customer_id, quantity_sold, sale_amount, region)
SELECT
    '2024-01-01'::date + (floor(random() * 365))::int as sale_date,
    floor(random() * 10000 + 1)::int as product_id,
    floor(random() * 50000 + 1)::int as customer_id,
    floor(random() * 10 + 1)::int as quantity_sold,
    round((random() * 1000 + 10)::numeric, 2) as sale_amount,
    case (floor(random() * 4)::int)
        when 0 then 'North'
        when 1 then 'South'
        when 2 then 'East'
        else 'West'
    end as region
FROM generate_series(1, 3000000) s(i);

-- 创建适当的索引以优化查询性能
CREATE INDEX idx_sales_product_date ON sales_data (product_id, sale_date);
CREATE INDEX idx_sales_customer ON sales_data (customer_id);
CREATE INDEX idx_sales_region ON sales_data (region);
</code></pre> <h3 id=_26>大数据量性能对比测试</h3> <p>为了充分展示分区表在处理大数据量时的优势，这里提供具体的测试用例和方法。</p> <pre><code class=language-sql>-- 为了比较分区表和普通表的性能差异，我们创建一个非分区对照表
CREATE TABLE sales_data_unpartitioned (
    sale_id         bigint generated always as identity,
    sale_date       date not null,
    product_id      int not null,
    customer_id     int not null,
    quantity_sold   int not null,
    sale_amount     numeric(10, 2) not null,
    region          varchar(50),
    PRIMARY KEY (sale_date, sale_id)
);

-- 在普通表上也创建相同的索引
CREATE INDEX idx_sales_product_date_unpart ON sales_data_unpartitioned (product_id, sale_date);
CREATE INDEX idx_sales_customer_unpart ON sales_data_unpartitioned (customer_id);
CREATE INDEX idx_sales_region_unpart ON sales_data_unpartitioned (region);

-- 往对照表中填充相同的数据集
INSERT INTO sales_data_unpartitioned (sale_date, product_id, customer_id, quantity_sold, sale_amount, region)
SELECT
    '2024-01-01'::date + (floor(random() * 365))::int as sale_date,
    floor(random() * 10000 + 1)::int as product_id,
    floor(random() * 50000 + 1)::int as customer_id,
    floor(random() * 10 + 1)::int as quantity_sold,
    round((random() * 1000 + 10)::numeric, 2) as sale_amount,
    case (floor(random() * 4)::int)
        when 0 then 'North'
        when 1 then 'South'
        when 2 then 'East'
        else 'West'
    end as region
FROM generate_series(1, 3000000) s(i);  -- 同样生成300万条记录

-- 现在可以通过 EXPLAIN ANALYZE 来比较两种方式的性能

-- 比较1：查询特定日期范围的数据
-- 分区表的查询计划
EXPLAIN ANALYZE
SELECT COUNT(*), SUM(sale_amount)
FROM sales_data
WHERE sale_date &gt;= '2024-06-01' AND sale_date &lt; '2024-07-01';

-- 非分区表的相同查询
EXPLAIN ANALYZE
SELECT COUNT(*), SUM(sale_amount)
FROM sales_data_unpartitioned
WHERE sale_date &gt;= '2024-06-01' AND sale_date &lt; '2024-07-01';

-- 比较2：按产品ID查找
-- 分区表的查询
EXPLAIN ANALYZE
SELECT sale_id, sale_date, sale_amount
FROM sales_data
WHERE product_id = 1234
ORDER BY sale_date DESC
LIMIT 10;

-- 非分区表的相同查询
EXPLAIN ANALYZE
SELECT sale_id, sale_date, sale_amount
FROM sales_data_unpartitioned
WHERE product_id = 1234
ORDER BY sale_date DESC
LIMIT 10;

-- 比较3：聚合查询
-- 分区表的聚合操作
EXPLAIN ANALYZE
SELECT
    region,
    COUNT(*) as transaction_count,
    SUM(sale_amount) as total_sales
FROM sales_data
GROUP BY region;

-- 非分区表的聚合操作
EXPLAIN ANALYZE
SELECT
    region,
    COUNT(*) as transaction_count,
    SUM(sale_amount) as total_sales
FROM sales_data_unpartitioned
GROUP BY region;

-- 在真实的性能测试中，你会发现：
-- 1. 对于只涉及单个分区的查询，分区表性能会显著优于普通表
-- 2. 跨分区查询的性能则更依赖于具体的条件和索引配置
-- 3. 随着数据量的增加，优势会更明显
</code></pre> <p>在大数据量的情况下，你还会遇到其他优化点和注意事项：</p> <h4 id=_27>数据分布</h4> <p>确保数据分布到各个分区中以均衡I/O操作：</p> <pre><code class=language-sql>-- 检查各分区的数据分布
SELECT
    schemaname,
    tablename,
    n_tup_ins - n_tup_del as approx_count
FROM pg_stat_user_tables
WHERE tablename LIKE 'sales%'
ORDER BY tablename;
</code></pre> <h4 id=_28>统计信息收集</h4> <p>对于大数据量分区表，需要定期更新统计信息：</p> <pre><code class=language-sql>-- 为单个分区收集统计信息
ANALYZE sales_jan2024;

-- 为所有分区收集统计信息
CALL partman.analyze_inherit('sales_data');
</code></pre> <h4 id=_29>重要的实现细节和注意事项</h4> <ul> <li>分区键选取: 应基于表的常用查询模式选择合适的分区键，如表单的创建时间、区域编码等</li> <li>分区大小的划分: 通常建议单个分区表大小不要超过数十GB到上百GB，以确保管理和维护的便利性</li> <li>分区表数量控制: 过多的分区可能造成元数据管理的开销过大，需要在粒度和管理复杂度间找平衡</li> <li>启用分区剪枝: 确保启用参数 enable_partition_pruning 来优化查询计划</li> <li>合理使用默认分区: 当遇到未知分区值时，默认分区能防止查询失败</li> <li>索引操作对子表无效: 在父表创建的索引对新增分区生效，但对已存在的分区可能不生效</li> </ul> <h3 id=_30>关于表转换的澄清</h3> <p>根据最新的理解，<strong>不能直接将常规表转换为分区表，反之亦然</strong>。但是，可以将现有的常规或分区表添加为分区表的分区，或从分区表中删除分区，将其转换为独立表。</p> <h4 id=_31>传统迁移方式</h4> <ol> <li>停机：CREATE TABLE AS / 重建序列</li> <li>不停机：</li> <li>逻辑复制</li> <li>双写机制</li> <li>触发器+复制机制</li> </ol> <h4 id=_32>现代迁移方式（通过将常规表作为分区）</h4> <pre><code class=language-sql>-- 场景：有一个很大的常规表包含所有数据
CREATE TABLE products_large (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    category_id INTEGER,
    price DECIMAL,
    create_time DATE
);
-- 例如此表包含了多年的累积数据

-- 步骤1：创建新的分区表框架
CREATE TABLE products_new (
    id SERIAL,
    name VARCHAR(255),
    category_id INTEGER,
    price DECIMAL,
    create_time DATE,
    PRIMARY KEY (create_time, id)
) PARTITION BY RANGE (create_time);

-- 步骤2：为新分区创建未来月份的分区
CREATE TABLE products_2024_feb PARTITION OF products_new
    FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');
CREATE TABLE products_2024_mar PARTITION OF products_new
    FOR VALUES FROM ('2024-03-01') TO ('2024-04-01');

-- 步骤3：将老表作为分区添加（将大表作为历史数据分区）
-- 首先重命名老表
ALTER TABLE products_large RENAME TO products_2023_and_before;

-- 将历史数据表添加为新分区表的一个分区
ALTER TABLE products_2023_and_before NO INHERIT products_large; -- 如果有继承
ALTER TABLE products_2023_and_before INHERIT products_new;

-- 或者使用 ATTACH PARTITION (PG11及以后版本)
-- 注意，这种方法需要先修改历史表使其结构完全匹配
-- ALTER TABLE products_new ATTACH PARTITION products_2023_and_before FOR VALUES FROM ('2000-01-01') TO ('2024-02-01');
</code></pre> <h2 id=_33>将现有常规表作为分区表的分区</h2> <p>当表的尺寸超过了数据库服务器物理内存时，需要考虑转为分区表。这个过程有停机和不停机两种方式。</p> <h3 id=_34>停机迁移</h3> <p>这种方法简单直观，但需要业务暂时停止服务。</p> <h4 id=select-into>SELECT INTO 方式</h4> <pre><code class=language-sql>-- 假设有个现有的表 orders，需要转换为基于日期的分区表
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    amount DECIMAL(10,2)
);

-- 在创建分区表时需要考虑原来的主键/唯一约束
CREATE TABLE orders_partitioned (
    id SERIAL,
    customer_id INT,
    order_date DATE,
    amount DECIMAL(10,2),
    PRIMARY KEY (order_date, id)  -- 重定义主键以包含分区键
) PARTITION BY RANGE (order_date);

-- 为不同时间段创建分区
CREATE TABLE orders_2023 PARTITION OF orders_partitioned
    FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');
CREATE TABLE orders_2024 PARTITION OF orders_partitioned
    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
CREATE TABLE orders_2025 PARTITION OF orders_partitioned
    FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');

-- 将数据迁移至新的分区表
INSERT INTO orders_partitioned (id, customer_id, order_date, amount) SELECT * FROM orders;

-- 重建索引
CREATE INDEX idx_orders_customer ON orders_partitioned (customer_id);
CREATE INDEX idx_orders_amount ON orders_partitioned (amount);

-- 停机操作: 重命名表
ALTER TABLE orders RENAME TO orders_old;
ALTER TABLE orders_partitioned RENAME TO orders;
</code></pre> <h4 id=copy>COPY 方式</h4> <p>此方式适合非常大的数据迁移，因为 COPY 在大批量数据迁移方面有更好的性能表现。</p> <pre><code class=language-sql>-- 创建临时文件
\copy (SELECT * FROM orders) TO 'orders_backup.dump' WITH CSV HEADER;

-- 按上述相同步骤创建分区表...

-- 然后批量载入数据
\copy orders_partitioned FROM 'orders_backup.dump' WITH CSV HEADER;

-- 验证数据
SELECT COUNT(*) FROM orders_partitioned;
SELECT COUNT(*) FROM orders_old;
</code></pre> <h3 id=_35>不停机迁移</h3> <p>不停机转换对于关键业务非常有价值，尽管过程更复杂。</p> <h4 id=_36>逻辑复制</h4> <p>使用 PostgreSQL 的逻辑复制特性，设置一个复制源表并逐步迁移:</p> <pre><code class=language-sql>-- 创建目标分区表，包含正确的主键/唯一约束
CREATE TABLE orders_subscription (
    id SERIAL,
    customer_id INT,
    order_date DATE,
    amount DECIMAL(10,2),
    PRIMARY KEY (order_date, id)
) PARTITION BY RANGE (order_date);

-- 为各个时段创建分区
CREATE TABLE orders_sub_2023 PARTITION OF orders_subscription
    FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');
CREATE TABLE orders_sub_2024 PARTITION OF orders_subscription
    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

-- 创建所需的索引
CREATE INDEX orders_sub_customer_idx ON orders_subscription (customer_id);

-- 在源库创建publication
CREATE PUBLICATION orders_pub FOR TABLE orders;

-- 在目标库创建subscription，连接到源库
CREATE SUBSCRIPTION orders_sub
  CONNECTION 'host=source_server port=5432 dbname=db_name'
  PUBLICATION orders_pub;

-- 等待复制开始，然后执行上面停机方法的数据插入部分:
INSERT INTO orders_subscription (id, customer_id, order_date, amount) SELECT * FROM orders;

-- 最后切换应用连接到分区表，并删除临时表和逻辑复制设施
</code></pre> <p>此方法需要注意:</p> <ul> <li>初次数据同步期间需要等待复制完成</li> <li>需要考虑网络中断等情况</li> <li>资源开销较大</li> </ul> <h4 id=pg_partman-pg_write>pg_partman + pg_write</h4> <p>PostgreSQL 版本 13 及以后内置的分区表功能已经非常强大和灵活。</p> <p>使用 <code>pg_partman</code> 可自动化管理数据的移动和归档。首先确保你安装了 <code>pg_partman</code>:</p> <pre><code class=language-sql>-- 安装扩展
CREATE EXTENSION IF NOT EXISTS pg_partman;

-- 创建符合主键/索引要求的新分区表
CREATE TABLE orders_new (
    id BIGSERIAL,
    customer_id INT,
    order_date DATE NOT NULL,
    amount DECIMAL(10,2),
    PRIMARY KEY (order_date, id)  -- 必须包含分区键
) PARTITION BY RANGE (order_date);

-- 在已有表上启用分区
SELECT partman.create_parent('public.orders_new', 'order_date', 'time', 'monthly');

-- 也可以为现有分区创建历史记录
SELECT partman.undo_partition('public.orders_history', 'table_loop', 2);
</code></pre> <p>这样可以将表在线转化为分区表，并自动处理后续的分区管理工作。</p> <p>不停机转换的流程通常涉及:</p> <ol> <li>创建一个新的符合分区要求的分区表</li> <li>同时插入两个表（双写）</li> <li>使用某种机制对比两表是否同步</li> <li>将读操作切换到新表</li> <li>检查一致后移除老表</li> </ol> <h2 id=_37>表分区管理</h2> <p>随着应用的发展，分区表管理成为一个关键任务，主要包括增加新分区、移除旧分区等操作。</p> <h3 id=pg_pathman>pg_pathman</h3> <p>pg_pathman 是一个 PostgreSQL 扩展，为 PostgreSQL 10 之前缺乏的声明式分区功能提供了高效的支持。在 Postgres 10 引入了原生的分区表功能后，它的价值逐渐降低。尤其在 PG 13+ 版本，官方原生分区性能大幅提升，pg_pathman 的维护也就逐渐停止。</p> <p>尽管不再被积极开发，但 pg_pathman 仍提供一些原生分区功能所没有的功能，比如:</p> <pre><code class=language-sql>-- 注意：此仅为 pg_pathman 示例，非标准 SQL
-- CREATE INDEX ON partition_table_pathman(id);
-- 会自动在子分区创建对应的索引
</code></pre> <p>不过，对于新项目，推荐使用官方提供的分区功能以获得更好的兼容性支持。</p> <h3 id=pg_partman>pg_partman</h3> <p><code>pg_partman</code> 扩展专门用于自动化管理 PostgreSQL 的分区表。它允许根据时间或序列自动创建、管理分区。对于需要按时间管理大量数据的应用特别有用。</p> <p>安装:</p> <pre><code class=language-sql>-- 安装扩展
CREATE EXTENSION pg_partman;
</code></pre> <p>使用 pg_partman 自动创建分区:</p> <pre><code class=language-sql>-- 创建父表，确保包含适当主键和唯一约束
CREATE TABLE test_data_time (
    id BIGSERIAL,
    created_time TIMESTAMPTZ NOT NULL DEFAULT now(),
    data TEXT,
    PRIMARY KEY (created_time, id)  -- 主键包含分区键
) PARTITION BY RANGE (created_time);

-- 启用自动分区管理
SELECT partman.create_parent('public.test_data_time', 'created_time', 'time', 'daily',
                              p_premake := 2, -- 预创建2个未来分区
                              p_start_partition := to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD'));

-- 查看自动创建的分区
SELECT child_table, value_from, value_to
FROM partman.show_partition_info('test_data_time');
</code></pre> <p>常见自动化管理功能:</p> <ul> <li>定期创建未来分区</li> <li>归档或删除旧分区</li> <li>自动优化索引维护策略</li> </ul> <p>对于分区维护工作来说，pg_partman 可以极大地减少管理开销。</p> <pre><code class=language-sql>-- 转换回非分区表
SELECT partman.undo_partition('public.test_data_time', 'table_loop', 2);
</code></pre> <p>这些管理策略和工具可确保分区表随时间推移仍保持高性能及可管理性，为大规模数据库应用提供了可靠的基础。</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2026 | Eamon </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.d7c377c4.min.js></script> <script src=../../../custom-js/custom-js.js></script> <script src=../../../redirect-md.js></script> </body> </html>